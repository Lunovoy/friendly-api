import{r as a,j as e,n as M,s as $,C as G,o as q}from"./index-BiqYdbNS.js";import{P as U}from"./Page-Dv3Yxcn8.js";import{c as w,A as D,B as H,D as J,M as K,d as Q,e as V,f as X,g as Y,G as Z,b as ee}from"./FiltersBlock-Iz-HQHXj.js";import{g as se,a as te,m as z,f as R,R as ae,U as ne,I as le,i as ie,s as oe,e as ce,B as re,j as de,F as ue}from"./useTagStore-CfbAclN9.js";import{u as A}from"./useTranslation-z379OQBV.js";import{F as xe}from"./Footer-CSK3jV5d.js";import"./Tabs-C9hVvUkL.js";const B=["#3b92f5","#ad9615","#e800a7","#55DA69"],pe=d=>{const{setCurrentColor:l}=d,[s,i]=a.useState(B[0]),[t,x]=a.useState("#fea9db"),[m,b]=a.useState(!1),f=a.useCallback(r=>{x(r.target.value)},[]),n=a.useCallback(()=>{b(!0)},[]),C=a.useCallback(r=>{i(r),b(!1)},[]);return a.useEffect(()=>{l(m?t:s)},[s,m,t,l]),e.jsxs("div",{className:"flex justify-between",children:[B.map(r=>e.jsx("button",{"aria-label":`Выберите цвет: ${r}`,type:"button",onClick:()=>C(r),style:{backgroundColor:r},className:`w-10 h-10 rounded-[4px] ${r===s&&!m?"outline-2 outline outline-offset-2 outline-white":""}`},r)),e.jsxs("label",{htmlFor:"colorPicker",className:`flex gap-[10px] p-1 bg-[#6490FF] rounded-[4px] items-center ${m?"outline-2 outline outline-offset-2 outline-white":""}`,children:[e.jsx("input",{id:"colorPicker",type:"color",className:"absolute opacity-0",value:t,onChange:f,onClick:n}),e.jsx("div",{className:"w-[30px] h-[30px] rounded-[4px]",style:{backgroundColor:t}}),e.jsx("p",{className:"text-[12px] text-white",children:"Свой цвет"})]})]})};function me(d){const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(d);return l?{red:parseInt(l[1],16),green:parseInt(l[2],16),blue:parseInt(l[3],16)}:{red:0,green:0,blue:0}}function fe(d){let l=d.red/255,s=d.green/255,i=d.blue/255;return l<=.03928?l/=12.92:l=((l+.055)/1.055)**2.4,s<=.03928?s/=12.92:s=((s+.055)/1.055)**2.4,i<=.03928?i/=12.92:i=((i+.055)/1.055)**2.4,.2126*l+.7152*s+.0722*i}function S(d){const l=me(d);return fe(l)>.179?"#090A0A":"white"}const _=d=>{var P;const{className:l,isOpened:s,setIsOpened:i,group:t}=d,{width:x}=M(),m=a.useMemo(()=>x??0,[x]),b=w(c=>c.isLoading),f=w(c=>c.createGroup),n=w(c=>c.updateGroup),C=se(c=>c.createTag),r=te(c=>c.addImageFriend),{t:u}=A("groups-page"),[p,N]=a.useState(t??{}),[h,y]=a.useState(),[o,F]=a.useState(""),[k,v]=a.useState(!1),I=a.useCallback(()=>{i(!1)},[i]),E=a.useCallback(async c=>{var T;let j="";if(h){const g=new FormData;g.append("image",h),j=await r(g)}const O=[];if((T=p.tags)!=null&&T.length)for(let g=0;g<p.tags.length;g+=1){const W=await C(p.tags[g].title||"");O.push(W)}if(j){let g;t!=null&&t.id?g=await n({...p,image_id:j,tags:O}):g=await f({...p,participants:c,image_id:j,tags:O}),g&&(v(!1),i(!1),N({}))}},[f,C,t==null?void 0:t.id,h,p,i,n,r]);return b?e.jsx("div",{className:"flex items-center justify-center fixed top-0 bottom-0 right-0 left-0 bg-slate-200 bg-opacity-25",children:e.jsx($,{})}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"rounded-t-[32px] rounded-b-[0px] md:rounded-b-[24px] md:rounded-t-[24px] bg-[#e5e7eb]",placement:"bottom-center",size:m<768?"full":"2xl",hideCloseButton:!0,isOpen:s,onClose:I,children:e.jsx(R,{children:e.jsxs("div",{className:"md:p-4 p-0 flex flex-col gap-3 overflow-auto transition-all rounded-b-[32px]",style:{backgroundColor:o},children:[e.jsxs("div",{className:"flex justify-center relative py-4",children:[e.jsx("h1",{className:"text-[18px]",style:{color:S(o)},children:t!=null&&t.id?u("Изменить группу"):u("Создать группу")}),e.jsx("button",{onClick:I,"aria-label":"Назад",type:"button",className:"absolute left-[18px] top-[50%] -translate-y-[50%]",children:e.jsx("img",{className:"rotate-180",src:ae,alt:""})})]}),e.jsx("div",{className:"flex justify-center pb-4",children:e.jsx(ne,{setImage:y})}),e.jsxs("div",{className:"p-6 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h2",{className:"font-bold",style:{color:S(o)},children:u("Название группы")}),e.jsx(le,{value:p.title,onChange:c=>N(j=>({...j,title:c.target.value})),placeholder:u("Придумайте название группы")})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h2",{className:"font-bold",style:{color:S(o)},children:u("Описание группы")}),e.jsx("textarea",{required:!0,maxLength:100,className:"w-full bg-[#F1F1F1] rounded-2xl p-5",cols:10,rows:5,placeholder:u("Описание группы"),onChange:c=>N(j=>({...j,description:c.target.value})),children:p.description})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h2",{className:"font-bold",style:{color:S(o)},children:u("Теги")}),e.jsx(ie,{tags:((P=p.tags)==null?void 0:P.map(c=>c.title))||[],setTags:c=>N(j=>({...j,tags:c.map(O=>({title:O}))})),placeholder:u("Введите теги")})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h2",{className:"font-bold",style:{color:S(o)},children:u("Цвет группы")}),e.jsx(pe,{setCurrentColor:F})]}),e.jsxs("div",{className:"flex justify-between gap-3 mt-7",children:[e.jsx("button",{"aria-label":"Отмена",type:"button",className:"py-3 px-5 focus:outline focus:outline-1 focus:outline-offset-2 focus:outline-white flex-grow bg-[#E5E5E5] rounded-full",children:e.jsx("p",{className:"align-super text-center",children:u("Отмена")})}),e.jsx("button",{"aria-label":"Продолжить",type:"button",className:"py-3 px-5 focus:outline focus:outline-1 focus:outline-offset-2 focus:outline-white flex-grow rounded-full bg-[#6490FF] disabled:bg-slate-300",disabled:!p.title||!(h!=null&&h.name),onClick:t!=null&&t.id?()=>E([]):()=>v(!0),children:e.jsxs("div",{className:"flex gap-2 items-center justify-center",children:[e.jsx(oe,{color:"#fff"}),e.jsx("p",{className:"text-white",children:u("Продолжить")})]})})]})]})]})})}),e.jsx(D,{isOpened:k,setIsOpened:v,onSaveFriends:E,selectedFriends:p.participants})]})},L=d=>{var y;const{className:l,group:s,setIsCreateEventOpened:i,onClose:t}=d,{t:x}=A("groups-page"),m=w(o=>o.deleteGroup),b=w(o=>o.addFriends),f=w(o=>o.deleteFriends),n=w(o=>o.isLoading),[C,r]=a.useState(!1),[u,p]=a.useState(!1),N=a.useCallback(async()=>{await m((s==null?void 0:s.id)||""),t==null||t()},[m,s==null?void 0:s.id,t]),h=a.useCallback(async o=>{const F=s==null?void 0:s.participants,k=o.filter(I=>!F.some(E=>E.id===I.id)),v=F.filter(I=>!o.includes(I));v!=null&&v.length&&await f(v,(s==null?void 0:s.id)||""),k!=null&&k.length&&await b(k,(s==null?void 0:s.id)||""),r(!1),t==null||t()},[b,f,s==null?void 0:s.id,s==null?void 0:s.participants,t]);return s?n?e.jsx(G,{className:"col-span-3 flex-grow flex justify-center items-center bg-slate-300 bg-opacity-30",children:e.jsx($,{})}):e.jsxs(G,{className:"col-span-3 p-0",children:[C&&e.jsx(D,{selectedFriends:(s==null?void 0:s.participants)||[],onSaveFriends:h,isOpened:C,setIsOpened:r}),u&&e.jsx(_,{group:s,isOpened:u,setIsOpened:p}),e.jsxs("div",{className:"p-6 flex flex-col gap-4 bg-[#86B3FF] rounded-[32px]",children:[e.jsx("div",{className:"flex items-center justify-start",children:e.jsxs("div",{className:"flex justify-between w-full",children:[t&&e.jsx("button",{onClick:t,type:"button","aria-label":"Закрыть просмотр",children:e.jsx("img",{src:H,alt:""})}),e.jsxs("div",{className:"flex justify-center gap-4 items-center flex-grow",children:[e.jsx("img",{src:s.image,alt:s.title,className:"rounded-full w-10 h-10"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"text-[20px] font-bold text-[#303030]",children:s.title}),e.jsx(ce,{tags:s.tags||[],hashSize:12})]})]}),e.jsx(J,{trigger:e.jsx("button",{type:"button","aria-label":"Открыть меню",children:e.jsx("img",{src:K,alt:""})}),sections:[{items:[{content:e.jsx("p",{children:x("Изменить группу")}),icon:e.jsx("img",{src:Q,alt:""}),key:"edit-event",onClick:()=>p(!0)},{content:e.jsx("p",{children:x("Изменить участников")}),icon:e.jsx("img",{src:V,alt:""}),key:"add-members",onClick:()=>r(!0)},{content:e.jsx("p",{children:x("Создать событие")}),icon:e.jsx(re,{size:20,color:"#6490FF"}),key:"create-event",onClick:()=>i==null?void 0:i(!0)}]},{items:[{content:e.jsx("p",{className:"text-red-400",children:x("Удалить группу")}),icon:e.jsx("img",{src:X,alt:""}),key:"delete-event",onClick:N}]}]})]})}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(de,{color:"#303030",size:14}),e.jsxs("p",{className:"text-[#303030] text-[14px]",children:[(y=s==null?void 0:s.participants)==null?void 0:y.length," ",x("участников")]})]}),e.jsx("p",{className:"text-[14px] text-[#303030] italic",children:s.description})]}),e.jsx(ue,{sourceFriendsList:(s==null?void 0:s.participants)||[]})]}):e.jsx(G,{className:"col-span-3",children:e.jsx("h1",{children:x("Выберите группу для просмотра")})})},he=d=>{const{className:l,children:s,isOpened:i,setIsOpened:t}=d,{width:x}=M(),m=a.useMemo(()=>x??0,[x]);return e.jsx(z,{className:"rounded-t-[32px] rounded-b-[0px] md:rounded-b-[24px] md:rounded-t-[24px] bg-[#e5e7eb]",placement:"bottom-center",size:m<768?"full":"2xl",hideCloseButton:!0,onClose:()=>t(!1),isOpen:i,children:e.jsx(R,{children:s})})},je={},Fe=a.memo(d=>{const{className:l}=d,{width:s}=M(),i=a.useMemo(()=>s??0,[s]),{t}=A("groups-page"),[x,m]=a.useState(!1),[b,f]=a.useState(!1),[n,C]=a.useState(),[r,u]=a.useState(!1),[p,N]=a.useState(),h=a.useCallback(F=>{C(F),f(!0)},[]),y=a.useCallback(()=>{f(!1)},[]),o=a.useCallback(()=>{N({title:`${t("Событие для")} ${n==null?void 0:n.title}`,description:`${t("Описание события для")} ${n==null?void 0:n.title}`,participants:n==null?void 0:n.participants,reminders:Y,frequency:"once"}),u(!0)},[n==null?void 0:n.participants,n==null?void 0:n.title,t]);return e.jsxs(U,{className:q(je.GroupsPage,{},[l]),children:[e.jsx(Z,{onCreateClick:i>768?()=>m(!0):void 0,onGroupSelect:h}),i>=768?e.jsx(L,{group:n,setIsCreateEventOpened:o}):e.jsxs(e.Fragment,{children:[e.jsx(he,{isOpened:b,setIsOpened:f,children:e.jsx(L,{setIsCreateEventOpened:o,onClose:y,group:n})}),e.jsx(xe,{handleAddButtonClick:()=>m(!0),className:"fixed bottom-4"})]}),e.jsx(_,{isOpened:x,setIsOpened:m}),e.jsx(ee,{sourceEvent:p,isOpen:r,setIsOpen:u})]})});export{Fe as default};
